<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacy Page</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <h1>Pharmacy Dashboard</h1>
        <h2>Make Orders: </h2>
        <form id="pharmacyOrderForm">
            <label for="distributor">Select Drug</label>
            <select id="distributor">
                <option value="distributor1">Drug 1</option>
                <option value="distributor2">Drug 2</option>
            </select>
            <label for="pharmacyQuantity">Quantity:</label>
            <input type="number" id="pharmacyQuantity" required>
            <button type="submit">Place Order</button>
        </form>

        <h2>Inventory Management</h2>
        <table>
            <thead>
                <tr>
                    <th>Drug Name</th>
                    <th>Quantity in Stock</th>
                    <th>Reorder Level</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="inventoryTable">
                <tr>
                    <td>Drug A</td>
                    <td class="stock" data-reorder="50">150</td>
                    <td>50</td>
                    <td class="status">In Stock</td>
                </tr>
                <tr>
                    <td>Drug B</td>
                    <td class="stock" data-reorder="30">80</td>
                    <td>30</td>
                    <td class="status">In Stock</td>
                </tr>
                <tr>
                    <td>Drug C</td>
                    <td class="stock" data-reorder="20">20</td>
                    <td>20</td>
                    <td class="status">In Stock</td>
                </tr>
            </tbody>
        </table>

        <h2>Pending Orders</h2>
        <table id="pendingOrdersTable">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Drug Name</th>
                    <th>Quantity Ordered</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <!-- Pending orders will be dynamically added here -->
            </tbody>
        </table>

        <a href="/">Logout</a>
    </div>

    <script>
        // Array to store pending orders
        const pendingOrders = [];

        // Function to check stock levels and alert if low
        function checkStockLevels() {
            const stocks = document.querySelectorAll('.stock');
            stocks.forEach(stock => {
                const quantity = parseInt(stock.textContent);
                const reorderLevel = parseInt(stock.dataset.reorder);
                const statusCell = stock.nextElementSibling;

                if (quantity <= reorderLevel) {
                    alert(`Alert: ${stock.parentElement.firstChild.textContent} is nearly depleted!`);
                    statusCell.textContent = 'Low Stock';
                    statusCell.style.color = 'red';
                } else {
                    statusCell.textContent = 'In Stock';
                    statusCell.style.color = 'green';
                }
            });
        }

        // Call the checkStockLevels function on page load
        checkStockLevels();

        // Handle order form submission
        document.getElementById('pharmacyOrderForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const quantity = parseInt(document.getElementById('pharmacyQuantity').value);
            const selectedDistributor = document.getElementById('distributor').value;

            // Simulate placing an order
            const orderId = Math.floor(Math.random() * 1000); // Generate a random order ID
            alert(`Order placed successfully to ${selectedDistributor} for ${quantity} units!`);

            // Add the order to the pending orders array
            pendingOrders.push({
                orderId: orderId,
                drugName: 'Drug C', // For simplicity, we are assuming Drug C is ordered
                quantity: quantity,
                status: 'Pending'
            });

            // Update the stock level (for demonstration purposes)
            const drugCStock = document.querySelector('.stock[data-reorder="20"]');
            let currentStock = parseInt(drugCStock.textContent);
            currentStock -= quantity; // Decrease stock based on order
            drugCStock.textContent = currentStock;

            // Check stock levels again after placing an order
            checkStockLevels();

            // Update the pending orders table
            updatePendingOrdersTable();
        });

        // Function to update the pending orders table
        function updatePendingOrdersTable() {
            const pendingOrdersTableBody = document.querySelector('#pendingOrdersTable tbody');
            pendingOrdersTableBody.innerHTML = ''; // Clear existing rows

            pendingOrders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.orderId}</td>
                    <td>${order.drugName}</td>
                    <td>${order.quantity}</td>
                    <td>${order.status}</td>
                `;
                pendingOrdersTableBody.appendChild(row);
            });
        }
    </script>
</body>
</html>
